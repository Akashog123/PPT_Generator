<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>PPT Generator</title>

  <!-- Icon font (kept) -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <!-- Fresh inline stylesheet: new palette, cards, shadows, rounded corners -->
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap');

    :root{
      --bg: #f6fbfb;
      --surface: #ffffff;
      --muted: #6b7280;
      --text: #0f172a;
      --accent: #0ea5a4; /* teal-ish */
      --accent-2: #6366f1; /* indigo */
      --glass: rgba(15,23,42,0.04);
      --card-shadow: 0 6px 18px rgba(2,6,23,0.06);
      --radius: 12px;
    }

    /* Dark mode variables under .dark on html element */
    .dark {
      --bg: #0b1220;
      --surface: #0f1724;
      --muted: #9aa4b2;
      --text: #e6eef8;
      --accent: #2bd4c7;
      --accent-2: #8b86ff;
      --glass: rgba(255,255,255,0.02);
      --card-shadow: 0 8px 26px rgba(2,6,23,0.6);
    }

    html,body{
      height:100%;
      margin:0;
      background:var(--bg);
      color:var(--text);
      font-family: "Poppins", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      box-sizing: border-box;
    }
    *, *::before, *::after { box-sizing: inherit; }

    /* Utility */
    .hidden { display:none !important; }
    .visually-hidden { position:absolute!important; height:1px;width:1px;overflow:hidden;clip:rect(1px,1px,1px,1px);white-space:nowrap;border:0;padding:0;margin:-1px; }

    /* App container */
    .app-wrap {
      max-width:1100px;
      margin:28px auto;
      padding:20px;
      display:grid;
      grid-template-columns: 280px 1fr;
      grid-template-rows: auto 1fr;
      gap:20px;
      align-items:start;
      box-sizing: border-box;
      height: calc(100vh - 56px);
      min-height: 0;
    }

    /* Top toolbar spans full width above grid */
    .topbar {
      grid-column: 1 / -1;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      margin-bottom:4px;
    }

    .brand {
      display:flex;
      gap:12px;
      align-items:center;
    }

    .logo {
      width:44px;
      height:44px;
      border-radius:10px;
      background:linear-gradient(135deg,var(--accent),var(--accent-2));
      box-shadow: 0 6px 18px rgba(99,102,241,0.14);
      display:flex;
      align-items:center;
      justify-content:center;
      color:#fff;
      font-weight:700;
      font-size:18px;
    }

    .title {
      font-weight:600;
      font-size:18px;
      letter-spacing:0.2px;
    }

    /* Theme toggle */
    .theme-toggle {
      display:flex;
      align-items:center;
      gap:10px;
    }
    .theme-toggle input { width:44px; height:26px; border-radius:999px; appearance:none; background:rgba(0,0,0,0.08); position:relative; cursor:pointer; outline:none; transition:all .18s ease; }
    .theme-toggle input:after { content:''; position:absolute; width:18px; height:18px; left:4px; top:4px; border-radius:50%; background:#fff; box-shadow:0 2px 6px rgba(2,6,23,0.08); transition:all .18s ease; }
    .dark .theme-toggle input { background:rgba(255,255,255,0.06); }
    .theme-toggle input:checked { background:var(--accent); }
    .theme-toggle input:checked:after { transform:translateX(18px); }

    /* Sidebar (left column) */
    .sidebar {
      background:var(--surface);
      border-radius:var(--radius);
      padding:18px;
      box-shadow:var(--card-shadow);
      min-height:0;
      display:flex;
      flex-direction:column;
      gap:14px;
      overflow:auto;
      max-height:100%;
      min-width:0;
    }

    .sidebar h4 { margin:0; font-size:14px; font-weight:600; color:var(--text); }
    .sidebar .muted { color:var(--muted); font-size:13px; margin-top:6px; }

    /* Provider cards */
    .providers {
      display:grid;
      grid-template-columns:1fr 1fr 1fr;
      gap:10px;
      margin-top:6px;
    }

    .provider-card {
      border-radius:10px;
      padding:12px;
      text-align:center;
      border:1px solid rgba(2,6,23,0.06);
      background:linear-gradient(180deg,var(--surface),var(--glass));
      cursor:pointer;
      transition:transform .14s ease, box-shadow .14s ease, border-color .14s ease;
      box-shadow:0 6px 12px rgba(2,6,23,0.03);
      user-select:none;
    }

    .provider-card:hover{ transform:translateY(-4px); box-shadow:0 12px 24px rgba(2,6,23,0.06); }
    .provider-card.selected { border-color: var(--accent); box-shadow:0 12px 28px rgba(14,165,164,0.12); transform:translateY(-6px); }

    .provider-card h3 { margin:0; font-size:14px; font-weight:600; }
    .provider-card p { margin:6px 0 0 0; color:var(--muted); font-size:13px; }

    /* Field rows */
    .field { display:flex; flex-direction:column; gap:8px; }
    label.field-label { font-size:13px; font-weight:600; color:var(--text); }

    input[type="text"], input[type="password"], select, textarea {
      border-radius:10px;
      border:1px solid rgba(2,6,23,0.06);
      padding:10px 12px;
      background:var(--surface);
      color:var(--text);
      box-shadow:inset 0 1px 0 rgba(255,255,255,0.02);
      transition:border-color .12s ease, box-shadow .12s ease, transform .06s ease;
      font-size:14px;
    }

    textarea { min-height:120px; max-height:40vh; resize:vertical; }

    input:focus, select:focus, textarea:focus { outline:none; border-color:var(--accent-2); box-shadow:0 6px 18px rgba(99,102,241,0.08); transform:translateY(-1px); }

    /* Main content card */
    .main {
      background:var(--surface);
      border-radius:var(--radius);
      padding:20px;
      box-shadow:var(--card-shadow);
      display:flex;
      flex-direction:column;
      gap:18px;
      overflow:auto;
      min-height:0;
    }

    /* File upload area */
    .file-upload {
      border-radius:10px;
      border:2px dashed rgba(2,6,23,0.06);
      background:linear-gradient(180deg,var(--surface),var(--glass));
      padding:18px;
      display:flex;
      gap:14px;
      align-items:center;
      transition:background .15s ease, border-color .15s ease, box-shadow .15s ease, transform .15s ease;
      cursor:pointer;
    }

    .file-upload:hover { transform:translateY(-4px); box-shadow:0 12px 24px rgba(2,6,23,0.05); }
    .file-upload.dragover { border-color:var(--accent); background: linear-gradient(180deg, rgba(14,165,164,0.03), var(--surface)); }

    .file-meta { display:flex; flex-direction:column; gap:4px; }
    .file-meta .name { font-weight:600; }
    .file-meta .size { color:var(--muted); font-size:13px; }

    .upload-icon {
      width:68px; height:68px; border-radius:10px;
      display:flex; align-items:center; justify-content:center;
      background:linear-gradient(135deg,var(--accent-2),var(--accent));
      color:#fff; font-size:22px; flex:0 0 68px;
      box-shadow:0 8px 20px rgba(99,102,241,0.12);
    }

    /* Small helper text */
    .help { color:var(--muted); font-size:13px; }

    /* CTA */
    .cta-wrap { display:flex; gap:12px; align-items:center; justify-content:flex-end; }
    .btn {
      border-radius:10px;
      padding:12px 18px;
      border:none;
      cursor:pointer;
      font-weight:600;
      transition:transform .12s ease, box-shadow .12s ease, opacity .12s ease;
      box-shadow:0 8px 20px rgba(2,6,23,0.06);
      background:linear-gradient(90deg,var(--accent-2),var(--accent));
      color:#fff;
      font-size:15px;
    }
    .btn:active{ transform:translateY(1px); }
    .btn:disabled { opacity:0.6; cursor:not-allowed; transform:none; box-shadow:none; }

    /* Small variations */
    .ghost { background:transparent; color:var(--accent-2); border:1px solid rgba(14,165,164,0.12); box-shadow:none; }

    /* Overlay */
    #generating-overlay {
      position:fixed;
      inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      background:rgba(2,6,23,0.6);
      z-index:1200;
    }
    #generating-overlay .dialog {
      background:var(--surface);
      color:var(--text);
      padding:26px;
      border-radius:14px;
      text-align:center;
      box-shadow:0 18px 50px rgba(2,6,23,0.5);
      max-width:420px;
    }
    #generating-overlay .spinner {
      width:48px; height:48px;
      border-radius:50%;
      border:5px solid rgba(2,6,23,0.08);
      border-top-color:var(--accent);
      animation:spin 1s linear infinite;
      margin:0 auto 14px;
    }
    @keyframes spin { to { transform:rotate(360deg); } }

    /* Responsive */
    @media (max-width:900px){
      .app-wrap { grid-template-columns: 1fr; grid-template-rows: auto auto 1fr; padding:16px; }
      .sidebar { grid-column: 1 / -1; }
      .main { grid-column: 1 / -1; }
      .topbar { flex-direction:column; align-items:flex-start; gap:8px; }
    }
  </style>
</head>
<body>
  <!-- Topbar -->
  <div class="app-wrap">
    <div class="topbar">
      <div class="brand">
        <div class="logo">PPT</div>
        <div>
          <div class="title"> PPT Presentation Generator</div>
          <div class="help">Create presentations from structured prompts</div>
        </div>
      </div>

      <div class="theme-toggle" title="Toggle dark / light theme">
        <label class="theme" for="theme-toggle">Theme</label>
        <input type="checkbox" id="theme-toggle" aria-label="Toggle theme">
      </div>
    </div>

    <!-- Sidebar: provider + model + key -->
    <aside class="sidebar" aria-label="Controls">
      <div class="field">
        <label class="field-label">API Provider</label>
        <div class="providers" role="list">
          <div class="provider-card" data-provider="gemini" role="listitem" tabindex="0">
            <h3>Gemini</h3>
          </div>
          <div class="provider-card" data-provider="openai" role="listitem" tabindex="0">
            <h3>OpenAI</h3>
          </div>
          <div class="provider-card" data-provider="claude" role="listitem" tabindex="0">
            <h3>Claude</h3>
          </div>
        </div>
        <input type="hidden" id="provider" name="provider" value="gemini">
      </div>

      <div class="field">
        <label class="field-label" for="model">Model</label>
        <select id="model" name="model" aria-label="Select model">
          <option value="gemini-2.5-flash">gemini-2.5-flash</option>
          <option value="gemini-1.5-pro">gemini-1.5-pro</option>
          <option value="gemini-1.5-flash">gemini-1.5-flash</option>
        </select>
      </div>

      <div class="field">
        <label class="field-label" for="api_key">API Key</label>
        <input type="password" id="api_key" name="api_key" placeholder="Enter your API key" required>
        <div class="muted">Used for this request only — not stored.</div>
      </div>

      <div class="field">
        <label class="inline-flex items-center field-label">
          <input type="checkbox" id="use-custom-model" name="use_custom_model" style="width:18px;height:18px;">
          <span style="margin-left:8px;font-weight:500;font-size:13px;color:var(--muted)">Use custom OpenAI-compatible model</span>
        </label>
      </div>

      <div id="custom-model-section" class="field hidden" aria-hidden="true">
        <label class="field-label">Custom Model (OpenAI compatible)</label>
        <input type="text" id="custom-base-url" name="custom_base_url" placeholder="https://api.example.com/v1">
        <input type="text" id="custom-model-name" name="custom_model_name" placeholder="Model name (e.g., gpt-4)">
        <div class="help">For custom endpoints (OpenAI, Azure, etc.).</div>
      </div>
    </aside>

    <!-- Main area -->
    <main class="main" aria-labelledby="main-heading">
      <h2 id="main-heading" style="margin:0;font-size:16px;font-weight:600">Upload template & content</h2>

      <!-- Form -->
      <form id="generate-form" action="/generate" method="post" enctype="multipart/form-data" style="display:flex;flex-direction:column;gap:14px;">
        <label class="field-label">PowerPoint Template</label>

        <label for="ppt-file" class="file-upload file-upload-label" tabindex="0">
          <div class="upload-icon"><i class="fas fa-file-upload"></i></div>
          <div class="file-meta">
            <div style="font-weight:600">Click or drop a .pptx file here</div>
            <div class="help">Accepted: .pptx</div>
          </div>
          <input id="ppt-file" name="ppt_file" type="file" accept=".pptx" class="visually-hidden" required>
        </label>

        <div id="file-info" class="field hidden" aria-live="polite">
          <div style="display:flex;align-items:center;gap:10px">
            <i class="fas fa-file-powerpoint" style="color:#e0473c;font-size:20px"></i>
            <div>
              <div id="file-name" class="name">filename.pptx</div>
              <div id="file-size" class="size">2.4 MB</div>
            </div>
          </div>
        </div>

        <div class="field">
          <label class="field-label" for="user-content">Your Content</label>
          <textarea id="user-content" name="user_content" placeholder="Describe the content you want in your presentation. More detail -> better results." required></textarea>
          <div class="help">Include key points, bullets, and specific data.</div>
        </div>

        <div class="cta-wrap" style="margin-top:6px;">
          <button type="submit" id="generate-btn" class="btn" >
            Generate Presentation
          </button>
        </div>
      </form>
    </main>
  </div>

  <!-- Generating overlay -->
  <div id="generating-overlay" class="hidden" aria-hidden="true">
    <div class="dialog">
      <div class="spinner" role="status" aria-hidden="true"></div>
      <h3 style="margin:8px 0 6px;font-size:18px">Generating Presentation</h3>
      <div class="help">This may take a minute. Please keep this tab open.</div>
    </div>
  </div>

  <script>
    // Model options for each provider
    const modelOptions = {
      'gemini': [
        { value: 'gemini-2.5-flash', text: 'gemini-2.5-flash' },
        { value: 'gemini-1.5-pro', text: 'gemini-1.5-pro' },
        { value: 'gemini-1.5-flash', text: 'gemini-1.5-flash' }
      ],
      'openai': [
        { value: 'gpt-4', text: 'gpt-4' },
        { value: 'gpt-4-turbo', text: 'gpt-4-turbo' },
        { value: 'gpt-3.5-turbo', text: 'gpt-3.5-turbo' }
      ],
      'claude': [
        { value: 'claude-3-5-sonnet', text: 'claude-3.5-sonnet' },
        { value: 'claude-3-opus', text: 'claude-3-opus' },
        { value: 'claude-3-sonnet', text: 'claude-3-sonnet' }
      ]
    };
    
    // DOM Elements
    const providerCards = document.querySelectorAll('.provider-card');
    const providerInput = document.getElementById('provider');
    const modelSelect = document.getElementById('model');
    const fileInput = document.getElementById('ppt-file');
    const fileInfo = document.getElementById('file-info');
    const fileName = document.getElementById('file-name');
    const fileSize = document.getElementById('file-size');
    const themeToggle = document.getElementById('theme-toggle');
    const useCustomModelCheckbox = document.getElementById('use-custom-model');
    const customModelSection = document.getElementById('custom-model-section');
    const customBaseUrlInput = document.getElementById('custom-base-url');
    const customModelNameInput = document.getElementById('custom-model-name');
    const generateBtn = document.getElementById('generate-btn');
    const generatingOverlay = document.getElementById('generating-overlay');
    const form = document.getElementById('generate-form');
    const fileUploadLabel = document.querySelector('.file-upload-label');

    // Helper to toggle hidden state (keeps original class usage)
    function show(el){ el.classList.remove('hidden'); el.setAttribute('aria-hidden','false'); }
    function hide(el){ el.classList.add('hidden'); el.setAttribute('aria-hidden','true'); }

    // Theme Management
    function initTheme() {
      const isDark = localStorage.getItem('theme') === 'dark' ||
                    (!localStorage.getItem('theme') && window.matchMedia('(prefers-color-scheme: dark)').matches);
      
      if (isDark) {
        document.documentElement.classList.add('dark');
        themeToggle.checked = true;
      } else {
        document.documentElement.classList.remove('dark');
        themeToggle.checked = false;
      }
    }
    
    themeToggle.addEventListener('change', function() {
      if (this.checked) {
        document.documentElement.classList.add('dark');
        localStorage.setItem('theme', 'dark');
      } else {
        document.documentElement.classList.remove('dark');
        localStorage.setItem('theme', 'light');
      }
    });

    // Provider Selection
    providerCards.forEach(card => {
      card.addEventListener('click', () => {
        providerCards.forEach(c => c.classList.remove('selected'));
        card.classList.add('selected');
        
        const provider = card.getAttribute('data-provider');
        providerInput.value = provider;
        updateModelOptions(provider);
        
        customModelSection.classList.add('hidden');
        useCustomModelCheckbox.checked = false;
      });
      // allow keyboard selection
      card.addEventListener('keydown', (e) => { if(e.key === 'Enter' || e.key === ' ') { e.preventDefault(); card.click(); } });
    });
    
    // Custom Model Toggle
    useCustomModelCheckbox.addEventListener('change', function() {
      if (this.checked) {
        customModelSection.classList.remove('hidden');
        // Clear default model selection
        modelSelect.value = '';
      } else {
        customModelSection.classList.add('hidden');
        // Restore default model selection for current provider
        const provider = providerInput.value;
        if (modelOptions[provider] && modelOptions[provider].length > 0) {
          modelSelect.value = modelOptions[provider][0].value;
        }
      }
    });
    
    // Update model options
    function updateModelOptions(provider) {
      modelSelect.innerHTML = '';
      modelOptions[provider].forEach(option => {
        const opt = document.createElement('option');
        opt.value = option.value;
        opt.text = option.text;
        modelSelect.appendChild(opt);
      });
      
      // Reset custom model section when changing providers
      customModelSection.classList.add('hidden');
      useCustomModelCheckbox.checked = false;
      customBaseUrlInput.value = '';
      customModelNameInput.value = '';
    }
    
    // File handling
    fileInput.addEventListener('change', function() {
      if (this.files.length > 0) {
        const file = this.files[0];
        fileName.textContent = file.name;
        const sizeInMB = (file.size / (1024 * 1024)).toFixed(2);
        fileSize.textContent = `${sizeInMB} MB`;
        fileInfo.classList.remove('hidden');
      } else {
        fileInfo.classList.add('hidden');
      }
    });
    
    // Drag and drop functionality
    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
      if (fileUploadLabel) fileUploadLabel.addEventListener(eventName, preventDefaults, false);
    });
    
    function preventDefaults(e) {
      e.preventDefault();
      e.stopPropagation();
    }
    
    ['dragenter', 'dragover'].forEach(eventName => {
      if (fileUploadLabel) fileUploadLabel.addEventListener(eventName, highlight, false);
    });
    
    ['dragleave', 'drop'].forEach(eventName => {
      if (fileUploadLabel) fileUploadLabel.addEventListener(eventName, unhighlight, false);
    });
    
    function highlight(e) {
      fileUploadLabel.classList.add('dragover');
    }
    
    function unhighlight(e) {
      fileUploadLabel.classList.remove('dragover');
    }
    
    if (fileUploadLabel) fileUploadLabel.addEventListener('drop', handleDrop, false);
    
    function handleDrop(e) {
      const dt = e.dataTransfer;
      const files = dt.files;
      
      if (files.length > 0 && files[0].name.endsWith('.pptx')) {
        fileInput.files = files;
        const event = new Event('change', { bubbles: true });
        fileInput.dispatchEvent(event);
      }
    }
    
    // Form submission handling with AJAX
    form.addEventListener('submit', function(e) {
      e.preventDefault();
      generatingOverlay.classList.remove('hidden');
      generateBtn.disabled = true;
      generateBtn.textContent = 'Generating...';
      
      // Validate custom model if selected
      if (useCustomModelCheckbox.checked) {
        if (!customBaseUrlInput.value.trim() || !customModelNameInput.value.trim()) {
          alert('Please enter both the base API URL and model name for custom models.');
          generatingOverlay.classList.add('hidden');
          generateBtn.disabled = false;
          generateBtn.textContent = 'Generate Presentation';
          return;
        }
        
        // Validate URL format
        if (!customBaseUrlInput.value.trim().startsWith('http://') && !customBaseUrlInput.value.trim().startsWith('https://')) {
          alert('Custom base URL must start with "http://" or "https://".');
          generatingOverlay.classList.add('hidden');
          generateBtn.disabled = false;
          generateBtn.textContent = 'Generate Presentation';
          return;
        }
        
        // Set provider to 'openai' for custom models
        providerInput.value = 'openai';
      }
      
      // Create FormData object
      const formData = new FormData(form);
      // Append provider, model and api key which are outside the form element
      formData.append('provider', providerInput.value || 'gemini');
      if (modelSelect && modelSelect.value) formData.append('model', modelSelect.value);
      const apiKeyInput = document.getElementById('api_key');
      if (apiKeyInput && apiKeyInput.value) formData.append('api_key', apiKeyInput.value);
      // If custom model is used, include its fields as well
      if (useCustomModelCheckbox.checked) {
        if (customBaseUrlInput && customBaseUrlInput.value) formData.append('custom_base_url', customBaseUrlInput.value.trim());
        if (customModelNameInput && customModelNameInput.value) formData.append('custom_model_name', customModelNameInput.value.trim());
      }
      
      // Send request using fetch
      fetch('/generate', {
        method: 'POST',
        body: formData
      })
      .then(response => {
        if (response.ok) {
          // Get filename from Content-Disposition header
          const contentDisposition = response.headers.get('Content-Disposition');
          let filename = 'generated_presentation.pptx';
          if (contentDisposition) {
            const filenameMatch = contentDisposition.match(/filename="?(.+?)"?$/);
            if (filenameMatch && filenameMatch[1]) {
              filename = filenameMatch[1];
            }
          }
          
          // Create blob from response
          return response.blob().then(blob => {
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            
            // Clean up
            setTimeout(() => {
              document.body.removeChild(a);
              window.URL.revokeObjectURL(url);
              
              // Hide generating overlay and re-enable button
              generatingOverlay.classList.add('hidden');
              generateBtn.disabled = false;
              generateBtn.textContent = 'Generate Presentation';
            }, 100);
          });
        } else {
          return response.text().then(text => {
            throw new Error(text);
          });
        }
      })
      .catch(error => {
        console.error('Error:', error);
        alert('Error generating presentation: ' + error.message);
        
        // Hide generating overlay and re-enable button
        generatingOverlay.classList.add('hidden');
        generateBtn.disabled = false;
        generateBtn.textContent = 'Generate Presentation';
      });
    });
    
    // Initialize
    document.addEventListener('DOMContentLoaded', function() {
      initTheme();
      // Ensure first provider is selected if present
      if (providerCards && providerCards.length > 0) providerCards[0].click();
    });
  </script>
</body>
</html>